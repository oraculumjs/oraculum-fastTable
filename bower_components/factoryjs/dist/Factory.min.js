/*! FactoryJS 1.0.0 */
(function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},b=[].slice;define(["underscore","jquery","backbone"],function(c,d,e){var f,g;return g=function(a,b){var d,e,f,g,h;null==a&&(a={}),null==b&&(b={}),h=[];for(f in b)d=b[f],g=null!=a[f]?a[f]:a[f]=d,e=c.isObject(g)||c.isObject(d),e&&(c.isDate(g)||c.isDate(d)||c.isElement(g)||c.isElement(d)||c.isFunction(g)||c.isFunction(d)||c.isRegExp(g)||c.isRegExp(d)||(c.isArray(g)||c.isArray(d)?a[f]=g.concat(d):h.push(a[f]=c.extend({},d,g))));return h},f=function(){function f(a,b){null==b&&(b={}),this.mixins={},this.mixinSettings={},this.tagCbs={},this.tagMap={},this.promises={},this.instances={},this.definitions={},this.define("Base",a),this.baseTags=b.baseTags||[],this.on("create",this.handleCreate,this)}return c.extend(f.prototype,e.Events),f.prototype.define=function(a,b,f){var g,h,i,j;if(null==f&&(f={}),null!=this.definitions[a]&&!f.override){if(f.silent)return this;throw h="Definition already exists :: "+a+" :: user overide option to ignore",new Error(h)}return null==(j=this.promises)[a]&&(j[a]=d.Deferred()),g={options:f},c.isFunction(b.extend)||(b.extend=e.Model.extend),g.constructor=c.isFunction(b)?b:function(){return c.clone(b)},g.constructor.prototype.__factory=function(a){return function(){return a}}(this),i=[a].concat(f.tags).concat(this.baseTags),g.tags=c.uniq(i).filter(function(a){return!!a}),this.instances[a]=[],c.each(g.tags,function(a){return function(b){return a.tagMap[b]=a.tagMap[b]||[],a.tagCbs[b]=a.tagCbs[b]||[]}}(this)),this.definitions[a]=g,this.trigger("define",a,g,f),this.promises[a].resolve(this,a),this},f.prototype.hasDefinition=function(a){return!!this.definitions[a]},f.prototype.whenDefined=function(a){var b;return null==(b=this.promises)[a]&&(b[a]=d.Deferred()),this.promises[a].promise()},f.prototype.fetchDefinition=function(a){var b;return b=this.whenDefined(a),require([a],function(b){return function(c){return b.define(a,c)}}(this)),b},f.prototype.extend=function(a,b,d,e){var f,h,i;if(null==e&&(e={}),f=this.definitions[a],!f)throw new Error("Base Class Not Available :: "+a);if(!c.isObject(d))throw new Error("Invalid Parameter Definition ::\nexpected object ::\ngot "+d.constructor.prototype.toString());return e.tags=c.chain([]).union(e.tags).union(f.tags).compact().value(),e.inheritMixins&&(e.mixins=c.chain([]).union(f.options.mixins).union(e.mixins).compact().value(),i=d.mixinOptions,h=f.constructor.prototype.mixinOptions,g(i,h)),e.singleton=null!=e.singleton?e.singleton:f.options.singleton,this.define(b,f.constructor.extend(d),e)},f.prototype.clone=function(b){var e,g;if(e="Invalid Argument :: Expected Factory",!(b instanceof f))throw new Error(e);return g=[],c.each(["definitions","mixins","promises","mixinSettings"],function(a){return function(d){return c.defaults(a[d],b[d]),"definitions"===d?c.each(a[d],function(b,c){return b.options.singleton&&g.push(c),a[d][c].constructor.prototype.__factory=function(){return a}}):void 0}}(this)),c.each(["tagCbs","tagMap","promises","instances"],function(e){return function(f){var h,i,j,k,l,m,n;null==e[f]&&(e[f]={}),m=b[f],n=[];for(h in m)i=m[h],"instances"===f&&a.call(g,h)>=0&&(j=!0),c.isArray(i)&&(null==(k=e[f])[h]&&(k[h]=[]),e[f][h]=j?e[f][h]:i.concat(e[f][h])),c.isFunction(null!=i?i.resolve:void 0)?(null==(l=e[f])[h]&&(l[h]=d.Deferred()),n.push(e[f][h].done(i.resolve))):n.push(void 0);return n}}(this))},f.prototype.mirror=function(a){return a.off("create",a.handleCreate),c.chain(this).methods().each(function(b){return function(c){return a[c]=function(){return b[c].apply(b,arguments)}}}(this)),this.clone(a),c.chain(a).keys().each(function(b){return c.isFunction(a[b])?void 0:delete a[b]})},f.prototype.defineMixin=function(a,b,c){var d;if(null==c&&(c={}),null!=this.mixins[a]&&!c.override)throw d="Mixin already defined :: "+a+" :: use override option to ignore",new Error(d);return this.mixins[a]=b,this.mixinSettings[a]=c,this.trigger("defineMixin",a,b,c),this},f.prototype.composeMixinDependencies=function(a){var b,d,e,f,g;for(null==a&&(a=[]),e=[],f=0,g=a.length;g>f;f++)d=a[f],b=this.mixinSettings[d].mixins||[],e=e.concat(this.composeMixinDependencies(b)),e.push(d);return c.uniq(e)},f.prototype.applyMixin=function(b,d){var e,f,g,h,i;if(g=this.mixins[d],!g)throw new Error("Mixin Not Defined :: "+d);return b.____mixed||(f=!0,e=!0,b.____mixed=[]),a.call(b.____mixed,d)>=0?void 0:(h=this.mixinSettings[d],h.tags&&!e&&(b.____tags||(b.____tags=[]),b.____tags=b.____tags.concat(h.tags)),i=c.omit(g,"mixinOptions","mixinitialize","mixconfig"),c.extend(b,i),f?(this.mixinitialize(b,d),delete b.____mixed):b.____mixed.push(d),b)},f.prototype.mixinitialize=function(a,b){var d,e;return d=this.mixins[b],e=d.mixinitialize,c.isFunction(e)?e.call(a):void 0},f.prototype.handleMixins=function(a,d,e){var f,h,i,j,k,l,m,n,o,p,q,r,s,t;for(a.____mixed=[],a.mixinOptions=c.extend({},a.mixinOptions),k=this.composeMixinDependencies(d),a.__mixins=function(){return k.slice()},l=0,p=k.length;p>l;l++)i=k[l],this.applyMixin(a,i);for(t=k.slice().reverse(),m=0,q=t.length;q>m;m++)i=t[m],f=this.mixins[i],h=f.mixinOptions,j=a.mixinOptions,g(j,h),a.mixinOptions=c.extend({},h,j);for(n=0,r=k.length;r>n;n++)i=k[n],f=this.mixins[i],j=a.mixinOptions,"function"==typeof f.mixconfig&&f.mixconfig.apply(f,[j].concat(b.call(e)));for(o=0,s=k.length;s>o;o++)i=k[o],this.mixinitialize(a,i);return a.__mixin=c.chain(function(a,b,c){return a.____mixed=[],this.handleMixins(a,[b],c),delete a.____mixed}).bind(this).partial(a).value(),delete a.____mixed},f.prototype.handleInjections=function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a[c]=this.get(d));return e},f.prototype.handleCreate=function(a){var b,d,e,f,g,h,i,j;for(j=a.__tags(),f=0,h=j.length;h>f;f++)if(e=j[f],null==this.tagCbs[e]&&(this.tagCbs[e]=[]),d=this.tagCbs[e],0!==d.length)for(g=0,i=d.length;i>g;g++)b=d[g],c.isFunction(b)&&b(a);return!0},f.prototype.handleTags=function(a,b,d){var e,f,g,h,i;for(this.instances[a].push(b),f=c.toArray(d).concat(b.____tags||[]),b.____tags&&delete b.____tags,b.__tags=function(){return c.toArray(f)},e=[this.instances[a]],h=0,i=f.length;i>h;h++)g=f[h],null==this.tagMap[g]&&(this.tagMap[g]=[]),this.tagMap[g].push(b),e.push(this.tagMap[g]);return e=c.uniq(e),b.__factoryMap=function(){return[].slice.call(e)}},f.prototype.get=function(){var a,d,e,f,g,h,i,j,k,l,m,n;if(k=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],h=null!=(n=this.instances)[k]?n[k]:n[k]=[],g=this.instances[k][0],e=this.definitions[k],i="Invalid Definition :: "+k+" :: not defined",null==e)throw new Error(i);return d=e.constructor,l=e.options||{},m=!!l.singleton,j=l.mixins||[],f=l.injections||[],m&&g?g:(g=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(d,a,function(){}),g.__type=function(){return k},g.constructor=this.getConstructor(k),this.handleMixins(g,j,a),this.handleInjections(g,f),this.handleTags(k,g,e.tags),c.isFunction(g.constructed)&&g.constructed.apply(g,a),g.__dispose=function(a){return function(){return a.dispose(this)}}(this),this.trigger("create",g),g)},f.prototype.verifyTags=function(b){return b.__factoryMap?c.all(b.__factoryMap(),function(c){return a.call(c,b)>=0}):!1},f.prototype.dispose=function(b){return c.each(b.__factoryMap(),function(c){var d,e;if(d="Instance Not In Factory :: "+b+" :: disposal failed!",a.call(c,b)<0)throw new Error(d);for(e=[];c.indexOf(b)>-1;)e.push(c.splice(c.indexOf(b),1));return e}),this.trigger("dispose",b)},f.prototype.getConstructor=function(a,b){var d;return null==b&&(b=!1),b?this.definitions[a].constructor:(d=c.chain(this.get).bind(this).partial(a).value(),d.prototype=this.definitions[a].constructor.prototype,d)},f.prototype.onTag=function(a,b){var d,e,f,g,h,i;if(e="Invalid Argument :: "+typeof a+" provided :: expected String",!c.isString(a))throw new Error(e);if(e="Invalid Argument :: "+typeof b+" provided :: expected Function",!c.isFunction(b))throw new Error(e);for(i=this.tagMap[a]||[],g=0,h=i.length;h>g;g++)d=i[g],b(d);return null==(f=this.tagCbs)[a]&&(f[a]=[]),this.tagCbs[a].push(b),!0},f.prototype.offTag=function(a,b){var d,e;if(e="Invalid Argument :: "+typeof a+" provided :: expected String",!c.isString(a))throw new Error(e);if(null!=this.tagCbs[a]){if(!c.isFunction(b))return void(this.tagCbs[a]=[]);if(d=this.tagCbs[a].indexOf(b),e="Callback Not Found :: "+b+" :: for tag "+a,-1===d)throw new Error(e);return this.tagCbs[a].splice(d,1)}},f.prototype.isType=function(a,b){return a.__type()===b},f.prototype.getType=function(a){return a.__type()},f}()})}).call(this);